# Visual Architecture Diagrams

## ğŸ—ï¸ Container Diagram (Level 2 C4 Model)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                          WRENCOS BEAUTY PLATFORM                             â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      FRONTEND CONTAINER                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Vue.js Web Application                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - AI Dermatology Expert Chat Interface                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Text input / Voice input / Image upload                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Display responses with source citations                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  React Native Mobile Application                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Same features as web                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Native camera/microphone access                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ HTTP/REST                               â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   API GATEWAY CONTAINER                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Express.js Backend (Port 3000)                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Route: POST /api/ai-dermatology-expert/chat                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Route: POST /api/ai-dermatology-expert/analyze-skin        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Route: POST /api/ai-dermatology-expert/transcribe          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Route: POST /api/ai-dermatology-expert/text-to-speech      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Controllers:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - aiDermatologyExpertController.js                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ chat()                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ analyzeSkinImage()                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ transcribeAudio()                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ textToSpeech()                                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                    â”‚                    â”‚                         â”‚
â”‚         â†“                    â†“                    â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  EMBEDDING  â”‚    â”‚  VECTOR DB   â”‚    â”‚     LLM      â”‚                  â”‚
â”‚  â”‚  SERVICE    â”‚    â”‚  CONTAINER   â”‚    â”‚  CONTAINER   â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚
â”‚  â”‚ Gemini API  â”‚    â”‚ Qdrant       â”‚    â”‚ Gemini API   â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚
â”‚  â”‚ Model:      â”‚    â”‚ URL:         â”‚    â”‚ Model:       â”‚                  â”‚
â”‚  â”‚ text-       â”‚    â”‚ localhost:   â”‚    â”‚ gemini-2.0-  â”‚                  â”‚
â”‚  â”‚ embedding-  â”‚    â”‚ 6333         â”‚    â”‚ flash        â”‚                  â”‚
â”‚  â”‚ 004         â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚ Collection:  â”‚    â”‚ Features:    â”‚                  â”‚
â”‚  â”‚ Dimension:  â”‚    â”‚ dermatology_ â”‚    â”‚ - Chat       â”‚                  â”‚
â”‚  â”‚ 768         â”‚    â”‚ knowledge    â”‚    â”‚ - Vision     â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚              â”‚    â”‚ - Audio      â”‚                  â”‚
â”‚  â”‚ Purpose:    â”‚    â”‚ Points:      â”‚    â”‚ - TTS        â”‚                  â”‚
â”‚  â”‚ Generate    â”‚    â”‚ ~9,000       â”‚    â”‚              â”‚                  â”‚
â”‚  â”‚ vectors     â”‚    â”‚              â”‚    â”‚ Purpose:     â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚ Distance:    â”‚    â”‚ Generate     â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚ Cosine       â”‚    â”‚ responses    â”‚                  â”‚
â”‚  â”‚             â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                    â”‚                    â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   DATABASE CONTAINER                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  MongoDB Atlas                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Collections:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - conversations                                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Store chat history                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ User ID, message, response, timestamp                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - ai_dermatology_cache                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Cache responses for repeated queries                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ TTL: 30 days for regular, 180 days for sample questions   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - users                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ User profiles, preferences                                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 KNOWLEDGE BASE CONTAINER                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Text Files (backend/knowledge-sources/extracted-content/)    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  1. Fitzpatrick's Dermatology in General Medicine             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  2. Textbook of Cosmetic Dermatology                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  3. Chemical Peels - Procedures in Cosmetic Dermatology       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  4. Lasers in Dermatology and Medicine                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  5. Cosmetic Dermatology - Products and Procedures            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  6. Cosmetic Dermatology - Principles and Practice            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Processing:                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Split into ~1,500 char chunks                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Generate embeddings for each chunk                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Index into Qdrant                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Total: ~9,000 chunks                                        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                â”‚
â”‚                         USER SENDS QUERY                                      â”‚
â”‚                  "I have red patches on my cheeks"                            â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: FRONTEND SENDS REQUEST                                              â”‚
â”‚  POST /api/ai-dermatology-expert/chat                                        â”‚
â”‚  {                                                                            â”‚
â”‚      "message": "I have red patches on my cheeks",                           â”‚
â”‚      "conversationHistory": [...]                                            â”‚
â”‚  }                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: API GATEWAY RECEIVES REQUEST                                        â”‚
â”‚  - Validate input                                                            â”‚
â”‚  - Extract message and conversation history                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: LANGUAGE DETECTION                                                  â”‚
â”‚  - Detect language: English                                                  â”‚
â”‚  - Translate if needed: No translation needed                                â”‚
â”‚  - Query for RAG: "I have red patches on my cheeks"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: CACHE CHECK                                                         â”‚
â”‚  - Check MongoDB for cached response                                         â”‚
â”‚  - Not found (first time or conversation history exists)                     â”‚
â”‚  - Proceed to RAG                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: GENERATE QUERY EMBEDDING                                            â”‚
â”‚  - Input: "I have red patches on my cheeks"                                  â”‚
â”‚  - Model: Gemini text-embedding-004                                          â”‚
â”‚  - Output: [0.234, -0.567, 0.891, ..., 0.345] (768 dimensions)             â”‚
â”‚  - Time: ~400ms                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: VECTOR SEARCH IN QDRANT                                             â”‚
â”‚  - Query vector: [0.234, -0.567, 0.891, ..., 0.345]                        â”‚
â”‚  - Search algorithm: Cosine Similarity with HNSW optimization                â”‚
â”‚  - Compare with ~9,000 document vectors                                      â”‚
â”‚  - Filter by threshold: 0.4                                                  â”‚
â”‚  - Return top 3 results                                                      â”‚
â”‚  - Time: ~100ms                                                              â”‚
â”‚                                                                               â”‚
â”‚  Results:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Result 1: Score 0.8234 (82.34%) âœ… EXCELLENT                       â”‚   â”‚
â”‚  â”‚ Source: "Fitzpatrick's Dermatology in General Medicine"            â”‚   â”‚
â”‚  â”‚ Text: "Rosacea is a chronic inflammatory skin condition..."        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Result 2: Score 0.7156 (71.56%) âœ… GOOD                            â”‚   â”‚
â”‚  â”‚ Source: "Textbook of Cosmetic Dermatology"                         â”‚   â”‚
â”‚  â”‚ Text: "Contact dermatitis presents as localized erythema..."       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Result 3: Score 0.6234 (62.34%) âœ… FAIR                            â”‚   â”‚
â”‚  â”‚ Source: "Cosmetic Dermatology - Principles and Practice"           â”‚   â”‚
â”‚  â”‚ Text: "Inflammatory skin conditions require proper diagnosis..."   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: BUILD RAG CONTEXT                                                   â”‚
â”‚  - Combine 3 retrieved chunks with source citations                          â”‚
â”‚  - Context size: ~4,000 characters                                           â”‚
â”‚  - Ready for LLM                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: GENERATE RESPONSE WITH GEMINI LLM                                   â”‚
â”‚  - Input: Query + RAG Context + Conversation History                         â”‚
â”‚  - Model: Gemini 2.0 Flash                                                   â”‚
â”‚  - Temperature: 0.7 (balanced)                                               â”‚
â”‚  - Max tokens: 4096                                                          â”‚
â”‚  - Time: ~2,500ms                                                            â”‚
â”‚                                                                               â”‚
â”‚  Output: "Based on your description of red patches on your cheeks,          â”‚
â”‚  there are several possible conditions that could be responsible:            â”‚
â”‚                                                                               â”‚
â”‚  ## Possible Conditions                                                      â”‚
â”‚                                                                               â”‚
â”‚  ### 1. Rosacea[1]                                                          â”‚
â”‚  Rosacea is a chronic inflammatory skin condition characterized by           â”‚
â”‚  facial erythema (redness)...[1]                                            â”‚
â”‚                                                                               â”‚
â”‚  ### 2. Contact Dermatitis[2]                                               â”‚
â”‚  Contact dermatitis presents as localized erythema and inflammation...[2]   â”‚
â”‚                                                                               â”‚
â”‚  ### References                                                              â”‚
â”‚  [1] Fitzpatrick's Dermatology in General Medicine                          â”‚
â”‚  [2] Textbook of Cosmetic Dermatology                                       â”‚
â”‚  [3] Cosmetic Dermatology - Principles and Practice"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 9: SAVE TO CACHE                                                       â”‚
â”‚  - Save response to MongoDB                                                  â”‚
â”‚  - TTL: 30 days                                                              â”‚
â”‚  - Time: ~600ms                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 10: RETURN RESPONSE TO FRONTEND                                        â”‚
â”‚  {                                                                            â”‚
â”‚      "response": "Based on your description...",                             â”‚
â”‚      "sources": [                                                            â”‚
â”‚          {                                                                    â”‚
â”‚              "text": "Rosacea is a chronic inflammatory...",                â”‚
â”‚              "score": 0.8234,                                                â”‚
â”‚              "metadata": {                                                    â”‚
â”‚                  "source": "Fitzpatrick's Dermatology",                      â”‚
â”‚                  "chunkIndex": 45                                            â”‚
â”‚              }                                                                â”‚
â”‚          },                                                                   â”‚
â”‚          ...                                                                  â”‚
â”‚      ],                                                                       â”‚
â”‚      "timestamp": "2024-11-30T11:05:42.567Z",                               â”‚
â”‚      "_performance": {                                                        â”‚
â”‚          "totalTime": 4523,                                                  â”‚
â”‚          "contextSize": 4187,                                                â”‚
â”‚          "chunks": 3                                                         â”‚
â”‚      }                                                                        â”‚
â”‚  }                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 11: FRONTEND DISPLAYS RESPONSE                                         â”‚
â”‚  - Show AI response with markdown formatting                                 â”‚
â”‚  - Display source citations [1], [2], [3]                                    â”‚
â”‚  - Show references section with book titles                                  â”‚
â”‚  - Display performance metrics                                               â”‚
â”‚  - Allow follow-up questions                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Vector Search Visualization

```
Query: "I have red patches on my cheeks"
    â†“
Embedding: [0.234, -0.567, 0.891, ..., 0.345] (768 dims)
    â†“
Qdrant Vector Database (9,000 documents)
    â”‚
    â”œâ”€â†’ Document 1: [0.245, -0.580, 0.905, ..., 0.358]
    â”‚   Cosine Similarity: 0.8234 âœ… MATCH
    â”‚   "Rosacea is a chronic inflammatory..."
    â”‚
    â”œâ”€â†’ Document 2: [0.198, -0.512, 0.834, ..., 0.301]
    â”‚   Cosine Similarity: 0.7156 âœ… MATCH
    â”‚   "Contact dermatitis presents as..."
    â”‚
    â”œâ”€â†’ Document 3: [0.167, -0.445, 0.756, ..., 0.267]
    â”‚   Cosine Similarity: 0.6234 âœ… MATCH
    â”‚   "Inflammatory skin conditions require..."
    â”‚
    â”œâ”€â†’ Document 4: [0.089, -0.234, 0.456, ..., 0.123]
    â”‚   Cosine Similarity: 0.3891 âŒ FILTERED (< 0.4)
    â”‚   "Acne vulgaris is characterized by..."
    â”‚
    â””â”€â†’ ... (8,996 more documents)

Top 3 Results Returned:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Score: 0.8234 (82.34%) - Rosacea               â”‚
â”‚ 2. Score: 0.7156 (71.56%) - Contact Dermatitis    â”‚
â”‚ 3. Score: 0.6234 (62.34%) - Inflammation          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® Cosine Similarity Calculation

```
Query Vector A:     [0.234, -0.567, 0.891, ..., 0.345]
Document Vector B:  [0.245, -0.580, 0.905, ..., 0.358]

Step 1: Dot Product (A Â· B)
= (0.234 Ã— 0.245) + (-0.567 Ã— -0.580) + (0.891 Ã— 0.905) + ... + (0.345 Ã— 0.358)
= 0.0573 + 0.3289 + 0.8063 + ... + 0.1235
= 612.45

Step 2: Magnitude of A (||A||)
= âˆš(0.234Â² + (-0.567)Â² + 0.891Â² + ... + 0.345Â²)
= âˆš803.12
= 28.34

Step 3: Magnitude of B (||B||)
= âˆš(0.245Â² + (-0.580)Â² + 0.905Â² + ... + 0.358Â²)
= âˆš821.45
= 28.67

Step 4: Cosine Similarity
= A Â· B / (||A|| Ã— ||B||)
= 612.45 / (28.34 Ã— 28.67)
= 612.45 / 812.56
= 0.7534 (75.34% similar)

Interpretation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score: 0.7534 (75.34%)                             â”‚
â”‚ Category: ğŸŸ¢ EXCELLENT                             â”‚
â”‚ Meaning: Highly relevant information               â”‚
â”‚ Action: Include in RAG context                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ Performance Timeline

```
Timeline (milliseconds):
0ms     â”œâ”€ Request received
        â”‚
100ms   â”œâ”€ Language detection started
        â”‚
900ms   â”œâ”€ Language detection completed (~800ms)
        â”‚
950ms   â”œâ”€ Cache check completed (~50ms)
        â”‚
1000ms  â”œâ”€ Query embedding started
        â”‚
1400ms  â”œâ”€ Query embedding completed (~400ms)
        â”‚
1500ms  â”œâ”€ Vector search started
        â”‚
1600ms  â”œâ”€ Vector search completed (~100ms)
        â”‚
1650ms  â”œâ”€ RAG context built (~50ms)
        â”‚
1700ms  â”œâ”€ LLM generation started
        â”‚
4200ms  â”œâ”€ LLM generation completed (~2500ms)
        â”‚
4250ms  â”œâ”€ Response formatting (~50ms)
        â”‚
4300ms  â”œâ”€ Database save started
        â”‚
4900ms  â”œâ”€ Database save completed (~600ms)
        â”‚
5000ms  â””â”€ Response sent to frontend
        
Total Time: ~4,900ms (4.9 seconds)

Breakdown:
- Language Detection:  17.2%
- Query Embedding:     8.6%
- Vector Search:       2.2%
- LLM Generation:      54.0%
- Database Save:       12.9%
- Other:               5.1%
```

---

## ğŸ¯ Score Distribution

```
Similarity Score Distribution for Query "I have red patches on my cheeks"

1.0  â”¤
     â”‚
0.9  â”¤
     â”‚
0.8  â”¤                    â•­â”€ Result 1: 0.8234
     â”‚                    â”‚
0.7  â”¤                    â”‚  â•­â”€ Result 2: 0.7156
     â”‚                    â”‚  â”‚
0.6  â”¤                    â”‚  â”‚  â•­â”€ Result 3: 0.6234
     â”‚                    â”‚  â”‚  â”‚
0.5  â”¤                    â”‚  â”‚  â”‚
     â”‚                    â”‚  â”‚  â”‚
0.4  â”¤ â”€ Threshold       â”‚  â”‚  â”‚
     â”‚                    â”‚  â”‚  â”‚
0.3  â”¤                    â”‚  â”‚  â”‚
     â”‚                    â”‚  â”‚  â”‚
0.2  â”¤                    â”‚  â”‚  â”‚
     â”‚                    â”‚  â”‚  â”‚
0.1  â”¤                    â”‚  â”‚  â”‚
     â”‚                    â”‚  â”‚  â”‚
0.0  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     1    2    3    4    5    6    7    8    9

Results Above Threshold (0.4):
âœ… Result 1: 0.8234 (82.34%) - EXCELLENT
âœ… Result 2: 0.7156 (71.56%) - GOOD
âœ… Result 3: 0.6234 (62.34%) - FAIR

Results Below Threshold:
âŒ Result 4: 0.3891 (38.91%) - FILTERED OUT
âŒ Result 5: 0.3234 (32.34%) - FILTERED OUT
... (and so on)
```

---

## ğŸ”Œ API Interaction Diagram

```
Frontend                API Gateway              External Services
   â”‚                        â”‚                           â”‚
   â”‚  POST /chat            â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                           â”‚
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Detect Language          â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Gemini
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Language Result          â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Query Cache              â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ MongoDB
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Cache Result             â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Generate Embedding       â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Gemini
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Embedding Vector         â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Vector Search            â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Qdrant
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Top 3 Chunks             â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Generate Response        â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Gemini
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  AI Response              â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Save to Cache            â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ MongoDB
   â”‚                        â”‚                           â”‚
   â”‚                        â”‚  Cache Saved              â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                           â”‚
   â”‚  Response JSON         â”‚                           â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                        â”‚                           â”‚
```

---

## ğŸ“š Data Structure Diagram

```
Qdrant Collection: dermatology_knowledge

Point Structure:
{
    id: 1,
    vector: [0.234, -0.567, 0.891, ..., 0.345],  â† 768 dimensions
    payload: {
        text: "Rosacea is a chronic inflammatory skin condition...",
        metadata: {
            source: "Fitzpatrick's Dermatology in General Medicine",
            fileName: "Fitzpatrick's Dermatology in General Medicine.txt",
            chunkIndex: 45,
            fileChunkIndex: 12,
            totalChunksInFile: 342
        }
    }
}

MongoDB Collections:

conversations:
{
    _id: ObjectId(...),
    userId: "user123",
    message: "I have red patches on my cheeks",
    response: "Based on your description...",
    sources: [...],
    timestamp: ISODate("2024-11-30T11:05:42.567Z")
}

ai_dermatology_cache:
{
    _id: ObjectId(...),
    question: "I have red patches on my cheeks",
    response: "Based on your description...",
    sources: [...],
    language: "English",
    createdAt: ISODate("2024-11-30T11:05:42.567Z"),
    expiresAt: ISODate("2024-12-30T11:05:42.567Z")  â† TTL: 30 days
}
```

---

This visual guide provides comprehensive diagrams showing the container architecture, request flow, vector search process, and data structures used in the AI Dermatology Expert system.

